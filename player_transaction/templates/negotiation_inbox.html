{% extends 'base.html' %}
{% load static %}

{% block title %}Inbox Negosiasi - Premiere Trade{% endblock %}

{% block content %}
<div class="negotiation-container mx-[60px] text-[#333] my-12">
  <h1 class="mb-4 text-3xl font-bold">ðŸ“¨ Inbox Negosiasi - {{ club.name }}</h1>

  <h2 class="mb-3 text-2xl font-semibold">Tawaran Masuk</h2>
  {% if received_offers %}
  <table class="inbox-table w-full bg-white border-collapse rounded-lg overflow-hidden">
    <thead>
      <tr class="bg-gradient-to-r from-indigo-800 via-purple-700 to-purple-500">
        <th class="text-white p-[10px]">Dari Klub</th>
        <th class="text-white p-[10px]">Pemain</th>
        <th class="text-white p-[10px]">Harga Ditawar</th>
        <th class="text-white p-[10px]">Status</th>
        <th class="text-white p-[10px]">Aksi</th>
      </tr>
    </thead>
    <tbody>
      {% for nego in received_offers %}
      <tr class="border-b border-[#ccc] text-center">
        <td class="p-[10px]">{{ nego.from_club.name }}</td>
        <td class="p-[10px]">{{ nego.player.nama_pemain }}</td>
        <td class="p-[10px]">Rp{{ nego.offered_price|floatformat:0 }}</td>
        <td class="p-[10px]">{{ nego.status|title }}</td>
        <td class="p-[10px]">
          {% if nego.status == 'pending' %}
          <button class="accept-btn bg-[#28a745] text-white px-3 py-[6px] rounded-md border-none cursor-pointer hover:bg-[#218838] transition" data-id="{{ nego.id }}">Accept</button>
          <button class="reject-btn bg-[#dc3545] text-white px-3 py-[6px] rounded-md border-none cursor-pointer hover:bg-[#c82333] transition ml-2" data-id="{{ nego.id }}">Reject</button>
          {% else %}
          <span class="status capitalize">{{ nego.status|title }}</span>
          {% endif %}
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
  {% else %}
  <p class="mt-2 text-gray-600 italic">Tidak ada tawaran masuk.</p>
  {% endif %}

  <hr class="my-[70px] border-t border-gray-300">

  <h2 class="mb-3 text-2xl font-semibold">Tawaran Dikirim</h2>
  {% if sent_offers %}
  <table class="inbox-table w-full bg-white border-collapse rounded-lg overflow-hidden">
    <thead>
      <tr class="bg-gradient-to-r from-indigo-800 via-purple-700 to-purple-500">
        <th class="text-white p-[10px]">Kepada Klub</th>
        <th class="text-white p-[10px]">Pemain</th>
        <th class="text-white p-[10px]">Harga Ditawar</th>
        <th class="text-white p-[10px]">Status</th>
      </tr>
    </thead>
    <tbody>
      {% for nego in sent_offers %}
      <tr class="border-b border-[#ccc] text-center">
        <td class="p-[10px]">{{ nego.to_club.name }}</td>
        <td class="p-[10px]">{{ nego.player.nama_pemain }}</td>
        <td class="p-[10px]">Rp{{ nego.offered_price|floatformat:0 }}</td>
        <td class="p-[10px] capitalize">{{ nego.status|title }}</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
  {% else %}
  <p class="mt-2 text-gray-600 italic">Belum ada tawaran dikirim.</p>
  {% endif %}
</div>

<script>
document.addEventListener("DOMContentLoaded", () => {
  document.querySelectorAll(".accept-btn, .reject-btn").forEach((btn) => {
    btn.addEventListener("click", () => {
      const negoId = btn.dataset.id;
      const action = btn.classList.contains("accept-btn") ? "accept" : "reject";

      fetch(`/player_transaction/negotiation/${negoId}/${action}/`, {
        method: "POST",
        headers: {
          "X-CSRFToken": "{{ csrf_token }}",
          "X-Requested-With": "XMLHttpRequest",
        },
      })
      .then(res => res.json())
      .then(data => {
        alert(data.message);
        location.reload();
      });
    });
  });
});
</script>
{% endblock %}
